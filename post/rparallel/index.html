<!DOCTYPE html>
<!-- This site was created with Hugo Blox. https://hugoblox.com -->
<!-- Last Published: September 22, 2024 --><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Hugo Blox Builder 5.9.6" />
  

  
  












  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.047268c6dd09ad74ba54a0ba71837064.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css" integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.32e2e32cf1a4c1ea152e519f8b1fda79.css" />

  
  
  

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="/css/libs/chroma/github-dark.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  



























  
  
  






  <meta name="author" content="Li Zhe" />





  

<meta name="description" content="Table of Contents 1、简介 2、parallel包 2.1 mclapply 2.2 parLapply 3、foreach包与doParallel包 4、future包 5 、furrr包 6、RcppParallel包 7 、GPU 加速 8 、性能比较 9 、结论 1、简介 R语言提供了多种并行计算的方法，可以显著提高计算密集型任务的执行速度。本文章只简单介绍几种常用的并行计算方法，并提供示例代码，最后对比几种方法。
2、parallel包 parallel包是R中最基本和广泛使用的并行计算包。它是R基础安装的一部分，无需额外安装。
2.1 mclapply mclapply 函数适用于类 Unix 系统（Mac 、Linux等），使用 fork 机制创建子进程。" />



<link rel="alternate" hreflang="en-us" href="https://ikerlz.github.io/post/rparallel/" />
<link rel="canonical" href="https://ikerlz.github.io/post/rparallel/" />



  <link rel="manifest" href="/manifest.webmanifest" />



<link rel="icon" type="image/png" href="/media/icon_hu9ccd2acdcd774e20fa34966445b706a8_6997380_32x32_fill_lanczos_center_3.png" />
<link rel="apple-touch-icon" type="image/png" href="/media/icon_hu9ccd2acdcd774e20fa34966445b706a8_6997380_180x180_fill_lanczos_center_3.png" />

<meta name="theme-color" content="#1565c0" />










  






<meta property="twitter:card" content="summary_large_image" />

  <meta property="twitter:site" content="@wowchemy" />
  <meta property="twitter:creator" content="@wowchemy" />
<meta property="twitter:image" content="https://ikerlz.github.io/post/rparallel/featured.png" />



  

<meta property="og:type" content="article" />
<meta property="og:site_name" content="Zhe Li" />
<meta property="og:url" content="https://ikerlz.github.io/post/rparallel/" />
<meta property="og:title" content="R并行方法简述 | Zhe Li" />
<meta property="og:description" content="Table of Contents 1、简介 2、parallel包 2.1 mclapply 2.2 parLapply 3、foreach包与doParallel包 4、future包 5 、furrr包 6、RcppParallel包 7 、GPU 加速 8 、性能比较 9 、结论 1、简介 R语言提供了多种并行计算的方法，可以显著提高计算密集型任务的执行速度。本文章只简单介绍几种常用的并行计算方法，并提供示例代码，最后对比几种方法。
2、parallel包 parallel包是R中最基本和广泛使用的并行计算包。它是R基础安装的一部分，无需额外安装。
2.1 mclapply mclapply 函数适用于类 Unix 系统（Mac 、Linux等），使用 fork 机制创建子进程。" /><meta property="og:image" content="https://ikerlz.github.io/post/rparallel/featured.png" /><meta property="og:locale" content="en-us" />

  
    <meta
      property="article:published_time"
      content="2024-09-20T00:39:27&#43;08:00"
    />
  
  
    <meta property="article:modified_time" content="2023-09-20T00:39:27&#43;08:00">
  






    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ikerlz.github.io/post/rparallel/"
  },
  "headline": "R并行方法简述",
  
  "image": [
    "https://ikerlz.github.io/post/rparallel/featured.png"
  ],
  
  "datePublished": "2024-09-20T00:39:27+08:00",
  "dateModified": "2023-09-20T00:39:27+08:00",
  
  "author": {
    "@type": "Person",
    "name": "Zhe Li"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Zhe Li",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ikerlz.github.io/media/icon_hu9ccd2acdcd774e20fa34966445b706a8_6997380_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "Table of Contents 1、简介 2、parallel包 2.1 mclapply 2.2 parLapply 3、foreach包与doParallel包 4、future包 5 、furrr包 6、RcppParallel包 7 、GPU 加速 8 、性能比较 9 、结论 1、简介 R语言提供了多种并行计算的方法，可以显著提高计算密集型任务的执行速度。本文章只简单介绍几种常用的并行计算方法，并提供示例代码，最后对比几种方法。\n2、parallel包 parallel包是R中最基本和广泛使用的并行计算包。它是R基础安装的一部分，无需额外安装。\n2.1 mclapply mclapply 函数适用于类 Unix 系统（Mac 、Linux等），使用 fork 机制创建子进程。"
}
</script>

  

  




  
  
  

  
  

  


  
  <title>R并行方法简述 | Zhe Li</title>

  
  
  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="117388eb247b8d7cd6b8c1619372ded1" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.3a6bdbdff5d8a89d6e651adb3deec035.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header header--fixed">
  
  
  
  
  












<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">Zhe Li</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">Zhe Li</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>Home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#publications"><span>Publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#slides"><span>Slides</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#posts"><span>Posts</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#contact"><span>Contact</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/uploads/resume.pdf"><span>CV</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article">

  






















  
  



<div class="article-container pt-3">
  <h1>R并行方法简述</h1>

  
  <p class="page-subtitle">基于R包的并行方法</p>
  

  


<div class="article-metadata">

  
  
  
  
  <div>
    

  <span >
      Zhe Li</span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Sep 20, 2023
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    4 min read
  </span>
  

  
  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/classical-statistics/">Classical Statistics</a></span>
  

</div>

  





</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 720px;">
  <div style="position: relative">
    <img src="/post/rparallel/featured_hu65a896cd44a15512f6c099b8e3b5928e_1891905_d76f208d50d1bc8034e59f82db623d34.webp" width="720" height="720" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      

<details class="toc-inpage d-print-none  " open>
  <summary class="font-weight-bold">Table of Contents</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#1简介">1、简介</a></li>
    <li><a href="#2parallel包">2、<code>parallel</code>包</a>
      <ul>
        <li><a href="#21-mclapply">2.1 <code>mclapply</code></a></li>
        <li><a href="#22-parlapply">2.2 <code>parLapply</code></a></li>
      </ul>
    </li>
    <li><a href="#3foreach包与doparallel包">3、<code>foreach</code>包与<code>doParallel</code>包</a></li>
    <li><a href="#4future包">4、<code>future</code>包</a></li>
    <li><a href="#5-furrr包">5 、<code>furrr</code>包</a></li>
    <li><a href="#6rcppparallel包">6、<code>RcppParallel</code>包</a></li>
    <li><a href="#7-gpu-加速">7 、GPU 加速</a></li>
    <li><a href="#8-性能比较">8 、性能比较</a></li>
    <li><a href="#9-结论">9 、结论</a></li>
  </ul>
</nav>
</details>

<h2 id="1简介">1、简介</h2>
<p><strong><code>R</code>语言提供了多种并行计算的方法，可以显著提高计算密集型任务的执行速度。本文章只简单介绍几种常用的并行计算方法，并提供示例代码，最后对比几种方法。</strong></p>
<hr>
<h2 id="2parallel包">2、<code>parallel</code>包</h2>
<p><code>parallel</code>包是<code>R</code>中最基本和广泛使用的并行计算包。它是<code>R</code>基础安装的一部分，无需额外安装。</p>
<h3 id="21-mclapply">2.1 <code>mclapply</code></h3>
<p><code>mclapply</code> 函数适用于类 Unix 系统（Mac 、Linux等），使用 fork 机制创建子进程。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">parallel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建一个耗时的函数</span>
</span></span><span class="line"><span class="cl"><span class="n">time_consuming_function</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Sys.sleep</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>  <span class="c1"># 模拟耗时操作</span>
</span></span><span class="line"><span class="cl">  <span class="kr">return</span><span class="p">(</span><span class="n">x^2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置核心数</span>
</span></span><span class="line"><span class="cl"><span class="n">num_cores</span> <span class="o">&lt;-</span> <span class="nf">detectCores</span><span class="p">()</span> <span class="o">-</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 mclapply</span>
</span></span><span class="line"><span class="cl"><span class="nf">system.time</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="n">result</span> <span class="o">&lt;-</span> <span class="nf">mclapply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="n">time_consuming_function</span><span class="p">,</span> <span class="n">mc.cores</span> <span class="o">=</span> <span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><strong>优点</strong>：</p>
<ul>
<li>简单易用，语法类似于 <code>lapply</code></li>
<li>在 Unix-like 系统上效率高</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>不支持 Windows 系统</li>
<li>不适合需要共享大量数据的任务</li>
</ul>
<h3 id="22-parlapply">2.2 <code>parLapply</code></h3>
<p><code>parLapply</code> 函数适用于所有操作系统，包括 Windows。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 创建集群</span>
</span></span><span class="line"><span class="cl"><span class="n">cl</span> <span class="o">&lt;-</span> <span class="nf">makeCluster</span><span class="p">(</span><span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 parLapply</span>
</span></span><span class="line"><span class="cl"><span class="nf">system.time</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="n">result</span> <span class="o">&lt;-</span> <span class="nf">parLapply</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="n">time_consuming_function</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 停止集群</span>
</span></span><span class="line"><span class="cl"><span class="nf">stopCluster</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span></span></code></pre></div><p><strong>优点</strong>：</p>
<ul>
<li>跨平台兼容（包括 Windows）</li>
<li>适合需要在节点间共享大量数据的任务</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>相比 <code>mclapply</code>，设置稍微复杂</li>
<li>在某些情况下可能比 <code>mclapply</code> 慢</li>
</ul>
<hr>
<h2 id="3foreach包与doparallel包">3、<code>foreach</code>包与<code>doParallel</code>包</h2>
<p><code>foreach</code>包提供了一个更直观的并行循环接口。<code>doParallel</code>包为<code>foreach</code>提供了一个并行后端。二者经常同时使用达到并行的目的。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">foreach</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">doParallel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 注册并行后端</span>
</span></span><span class="line"><span class="cl"><span class="nf">registerDoParallel</span><span class="p">(</span><span class="n">cores</span> <span class="o">=</span> <span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 foreach</span>
</span></span><span class="line"><span class="cl"><span class="nf">system.time</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="n">result</span> <span class="o">&lt;-</span> <span class="nf">foreach</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="n">.combine</span> <span class="o">=</span> <span class="n">c</span><span class="p">)</span> <span class="o">%dopar%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">time_consuming_function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 停止并行后端</span>
</span></span><span class="line"><span class="cl"><span class="nf">stopImplicitCluster</span><span class="p">()</span>
</span></span></code></pre></div><p><strong>优点</strong>：</p>
<ul>
<li>语法直观，类似于常规的 for 循环</li>
<li>灵活，可以轻松组合结果</li>
<li>与多种并行后端兼容</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>需要额外安装包</li>
<li>对于简单任务可能有些过于复杂</li>
</ul>
<hr>
<h2 id="4future包">4、<code>future</code>包</h2>
<p><code>future</code>包提供了一个统一的并行和分布式处理框架，设计理念先进。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">future.apply</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置并行策略</span>
</span></span><span class="line"><span class="cl"><span class="nf">plan</span><span class="p">(</span><span class="n">multisession</span><span class="p">,</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 future_lapply</span>
</span></span><span class="line"><span class="cl"><span class="nf">system.time</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="n">result</span> <span class="o">&lt;-</span> <span class="nf">future_lapply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="n">time_consuming_function</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><strong>优点</strong>：</p>
<ul>
<li>提供统一的接口for并行和序列化计算</li>
<li>非常灵活，支持多种并行策略</li>
<li>可以轻松切换不同的并行后端</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>学习曲线可能较陡</li>
<li>对于简单任务可能显得过于复杂</li>
</ul>
<hr>
<h2 id="5-furrr包">5 、<code>furrr</code>包</h2>
<p><code>furrr</code>包结合了<code>purrr</code>的函数式编程和<code>future</code>的并行能力。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">furrr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置并行策略</span>
</span></span><span class="line"><span class="cl"><span class="nf">plan</span><span class="p">(</span><span class="n">multisession</span><span class="p">,</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 future_map</span>
</span></span><span class="line"><span class="cl"><span class="nf">system.time</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="n">result</span> <span class="o">&lt;-</span> <span class="nf">future_map</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="n">time_consuming_function</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><strong>优点</strong>：</p>
<ul>
<li>与<code>tidyverse</code>生态系统完美集成</li>
<li>语法简洁，易于使用</li>
<li>保持了<code>purrr</code>的一致性</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>需要熟悉<code>purrr</code>和函数式编程</li>
<li>对于不使用<code>tidyverse</code>的项目可能不是最佳选择</li>
</ul>
<hr>
<h2 id="6rcppparallel包">6、<code>RcppParallel</code>包</h2>
<p><code>RcppParallel</code>包提供了<code>C++</code>级别的并行计算能力。当然，<code>C++</code>本身已经足够快，如果会<code>C++</code>推荐直接写<code>C++</code>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">Rcpp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">RcppParallel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 定义 C++ 函数</span>
</span></span><span class="line"><span class="cl"><span class="nf">cppFunction</span><span class="p">(</span><span class="n">depends</span> <span class="o">=</span> <span class="s">&#34;RcppParallel&#34;</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="s">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s">#include &lt;RcppParallel.h&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">using namespace RcppParallel;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">struct SquareWorker : public Worker {
</span></span></span><span class="line"><span class="cl"><span class="s">  const RVector&lt;double&gt; input;
</span></span></span><span class="line"><span class="cl"><span class="s">  RVector&lt;double&gt; output;
</span></span></span><span class="line"><span class="cl"><span class="s">  
</span></span></span><span class="line"><span class="cl"><span class="s">  SquareWorker(const NumericVector input, NumericVector output) 
</span></span></span><span class="line"><span class="cl"><span class="s">    : input(input), output(output) {}
</span></span></span><span class="line"><span class="cl"><span class="s">  
</span></span></span><span class="line"><span class="cl"><span class="s">  void operator()(std::size_t begin, std::size_t end) {
</span></span></span><span class="line"><span class="cl"><span class="s">    std::transform(input.begin() + begin, input.begin() + end,
</span></span></span><span class="line"><span class="cl"><span class="s">                   output.begin() + begin,
</span></span></span><span class="line"><span class="cl"><span class="s">                   [](double x) { return x * x; });
</span></span></span><span class="line"><span class="cl"><span class="s">  }
</span></span></span><span class="line"><span class="cl"><span class="s">};
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">// [[Rcpp::export]]
</span></span></span><span class="line"><span class="cl"><span class="s">NumericVector parallelSquare(NumericVector x) {
</span></span></span><span class="line"><span class="cl"><span class="s">  NumericVector output(x.size());
</span></span></span><span class="line"><span class="cl"><span class="s">  SquareWorker worker(x, output);
</span></span></span><span class="line"><span class="cl"><span class="s">  parallelFor(0, x.size(), worker);
</span></span></span><span class="line"><span class="cl"><span class="s">  return output;
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 C++ 并行函数</span>
</span></span><span class="line"><span class="cl"><span class="n">large_vector</span> <span class="o">&lt;-</span> <span class="nf">runif</span><span class="p">(</span><span class="m">1e7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">system.time</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="n">result</span> <span class="o">&lt;-</span> <span class="nf">parallelSquare</span><span class="p">(</span><span class="n">large_vector</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><strong>优点</strong>：</p>
<ul>
<li>性能极高，特别适合计算密集型任务</li>
<li>可以充分利用多核 CPU</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>需要<code>C++</code>编程知识</li>
<li>开发和调试可能较为复杂</li>
</ul>
<hr>
<h2 id="7-gpu-加速">7 、GPU 加速</h2>
<p>对于特定类型的计算，可以使用 GPU 加速。例如，使用<code>gpuR</code>包：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">gpuR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建 GPU 矩阵</span>
</span></span><span class="line"><span class="cl"><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">gpuMatrix</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="m">1000</span><span class="o">*</span><span class="m">1000</span><span class="p">),</span> <span class="n">nrow</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="o">&lt;-</span> <span class="nf">gpuMatrix</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="m">1000</span><span class="o">*</span><span class="m">1000</span><span class="p">),</span> <span class="n">nrow</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># GPU 矩阵乘法</span>
</span></span><span class="line"><span class="cl"><span class="nf">system.time</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="n">C</span> <span class="o">&lt;-</span> <span class="n">A</span> <span class="o">%*%</span> <span class="n">B</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><strong>优点</strong>：</p>
<ul>
<li>对于某些类型的计算（如矩阵运算）性能极高</li>
<li>可以处理大规模数据</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>需要特定的硬件（GPU）</li>
<li>编程模型与 CPU 不同，可能需要学习新的技能</li>
<li>不是所有类型的计算都适合 GPU</li>
</ul>
<h2 id="8-性能比较">8 、性能比较</h2>
<p>下面比较了为了比较不同方法的性能，我们可以使用一个统一的测试函数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># 安装必要的包（如果尚未安装）</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&#34;parallel&#34;</span><span class="p">,</span> <span class="n">quietly</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span> <span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;parallel&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&#34;foreach&#34;</span><span class="p">,</span> <span class="n">quietly</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span> <span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;foreach&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&#34;doParallel&#34;</span><span class="p">,</span> <span class="n">quietly</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span> <span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;doParallel&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&#34;future&#34;</span><span class="p">,</span> <span class="n">quietly</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span> <span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;future&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&#34;future.apply&#34;</span><span class="p">,</span> <span class="n">quietly</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span> <span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;future.apply&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&#34;furrr&#34;</span><span class="p">,</span> <span class="n">quietly</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span> <span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;furrr&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&#34;microbenchmark&#34;</span><span class="p">,</span> <span class="n">quietly</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span> <span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;microbenchmark&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&#34;ggplot2&#34;</span><span class="p">,</span> <span class="n">quietly</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span> <span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;ggplot2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 加载必要的库</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">parallel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">foreach</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">doParallel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">future.apply</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">furrr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">microbenchmark</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置随机种子以确保结果可重现</span>
</span></span><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建一个计算密集型函数</span>
</span></span><span class="line"><span class="cl"><span class="n">intensive_function</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">result</span> <span class="o">&lt;-</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">sapply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">1e5</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="nf">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">i</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="kr">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建测试数据</span>
</span></span><span class="line"><span class="cl"><span class="n">test_data</span> <span class="o">&lt;-</span> <span class="nf">runif</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置核心数，减少到一个较小的值以避免连接限制</span>
</span></span><span class="line"><span class="cl"><span class="n">num_cores</span> <span class="o">&lt;-</span> <span class="nf">min</span><span class="p">(</span><span class="nf">detectCores</span><span class="p">()</span> <span class="o">-</span> <span class="m">1</span><span class="p">,</span> <span class="m">20</span><span class="p">)</span>  <span class="c1"># 使用最多20个核心</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 定义测试函数</span>
</span></span><span class="line"><span class="cl"><span class="n">run_test</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 1. 串行计算（基准）</span>
</span></span><span class="line"><span class="cl">  <span class="n">serial</span> <span class="o">&lt;-</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">intensive_function</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># 2. mclapply</span>
</span></span><span class="line"><span class="cl">  <span class="n">mc</span> <span class="o">&lt;-</span> <span class="nf">mclapply</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">intensive_function</span><span class="p">,</span> <span class="n">mc.cores</span> <span class="o">=</span> <span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># 3. parLapply</span>
</span></span><span class="line"><span class="cl">  <span class="n">cl</span> <span class="o">&lt;-</span> <span class="nf">makeCluster</span><span class="p">(</span><span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">par</span> <span class="o">&lt;-</span> <span class="nf">parLapply</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">intensive_function</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">stopCluster</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># 4. foreach</span>
</span></span><span class="line"><span class="cl">  <span class="n">cl</span> <span class="o">&lt;-</span> <span class="nf">makeCluster</span><span class="p">(</span><span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">registerDoParallel</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">foreach</span> <span class="o">&lt;-</span> <span class="nf">foreach</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">.combine</span> <span class="o">=</span> <span class="n">c</span><span class="p">)</span> <span class="o">%dopar%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">intensive_function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">stopCluster</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># 5. future.apply</span>
</span></span><span class="line"><span class="cl">  <span class="nf">plan</span><span class="p">(</span><span class="n">multisession</span><span class="p">,</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">future</span> <span class="o">&lt;-</span> <span class="nf">future_lapply</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">intensive_function</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># 6. furrr</span>
</span></span><span class="line"><span class="cl">  <span class="nf">plan</span><span class="p">(</span><span class="n">multisession</span><span class="p">,</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">furrr</span> <span class="o">&lt;-</span> <span class="nf">future_map</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">intensive_function</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># 检查结果是否一致</span>
</span></span><span class="line"><span class="cl">  <span class="n">all_equal</span> <span class="o">&lt;-</span> <span class="nf">all</span><span class="p">(</span><span class="nf">sapply</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">serial</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span> <span class="n">foreach</span><span class="p">,</span> <span class="n">future</span><span class="p">,</span> <span class="n">furrr</span><span class="p">),</span> <span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">all.equal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">serial</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="kr">if</span> <span class="p">(</span><span class="o">!</span><span class="n">all_equal</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">warning</span><span class="p">(</span><span class="s">&#34;警告：并非所有结果都相同&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 运行性能测试</span>
</span></span><span class="line"><span class="cl"><span class="n">benchmark</span> <span class="o">&lt;-</span> <span class="nf">microbenchmark</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">Serial</span> <span class="o">=</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">intensive_function</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="n">mclapply</span> <span class="o">=</span> <span class="nf">mclapply</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">intensive_function</span><span class="p">,</span> <span class="n">mc.cores</span> <span class="o">=</span> <span class="n">num_cores</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="n">parLapply</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">cl</span> <span class="o">&lt;-</span> <span class="nf">makeCluster</span><span class="p">(</span><span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">on.exit</span><span class="p">(</span><span class="nf">stopCluster</span><span class="p">(</span><span class="n">cl</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="nf">parLapply</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">intensive_function</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="n">foreach</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">cl</span> <span class="o">&lt;-</span> <span class="nf">makeCluster</span><span class="p">(</span><span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">on.exit</span><span class="p">(</span><span class="nf">stopCluster</span><span class="p">(</span><span class="n">cl</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="nf">registerDoParallel</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">foreach</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">.combine</span> <span class="o">=</span> <span class="n">c</span><span class="p">)</span> <span class="o">%dopar%</span> <span class="nf">intensive_function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="n">future.apply</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">plan</span><span class="p">(</span><span class="n">multisession</span><span class="p">,</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">future_lapply</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">intensive_function</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="n">furrr</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">plan</span><span class="p">(</span><span class="n">multisession</span><span class="p">,</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">num_cores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">future_map</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">intensive_function</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="n">times</span> <span class="o">=</span> <span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 打印结果</span>
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">benchmark</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 绘制性能比较图</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">&lt;-</span> <span class="nf">autoplot</span><span class="p">(</span><span class="n">benchmark</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ggtitle</span><span class="p">(</span><span class="s">&#34;R并行计算包性能比较&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_minimal</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 保存结果</span>
</span></span><span class="line"><span class="cl"><span class="nf">png</span><span class="p">(</span><span class="s">&#34;parallel_performance_comparison.png&#34;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">800</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">600</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 输出结果摘要</span>
</span></span><span class="line"><span class="cl"><span class="n">result_summary</span> <span class="o">&lt;-</span> <span class="nf">summary</span><span class="p">(</span><span class="n">benchmark</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">write.csv</span><span class="p">(</span><span class="n">result_summary</span><span class="p">,</span> <span class="s">&#34;parallel_performance_summary.csv&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">cat</span><span class="p">(</span><span class="s">&#34;性能测试完成。结果已保存为图片和CSV文件。\n&#34;</span><span class="p">)</span>
</span></span></code></pre></div><table>
<thead>
<tr>
<th>expr</th>
<th>min</th>
<th>lq</th>
<th>mean</th>
<th>median</th>
<th>uq</th>
<th>max</th>
<th>neval</th>
</tr>
</thead>
<tbody>
<tr>
<td>Serial</td>
<td>7159.18</td>
<td>7208.81</td>
<td>7288.79</td>
<td>7239.40</td>
<td>7372.14</td>
<td>7495.29</td>
<td>10</td>
</tr>
<tr>
<td>mclapply</td>
<td>435.23</td>
<td>440.91</td>
<td>507.09</td>
<td>511.28</td>
<td>571.28</td>
<td>582.68</td>
<td>10</td>
</tr>
<tr>
<td>parLapply</td>
<td>3414.19</td>
<td>3423.42</td>
<td>3458.23</td>
<td>3451.61</td>
<td>3473.22</td>
<td>3535.35</td>
<td>10</td>
</tr>
<tr>
<td>foreach</td>
<td>3358.31</td>
<td>3396.43</td>
<td>3438.25</td>
<td>3453.85</td>
<td>3476.20</td>
<td>3487.60</td>
<td>10</td>
</tr>
<tr>
<td>future.apply</td>
<td>3495.26</td>
<td>3582.65</td>
<td>3678.58</td>
<td>3653.03</td>
<td>3684.38</td>
<td>3949.47</td>
<td>10</td>
</tr>
<tr>
<td>furrr</td>
<td>5304.65</td>
<td>5368.64</td>
<td>5486.57</td>
<td>5459.82</td>
<td>5530.38</td>
<td>5756.27</td>
<td>10</td>
</tr>
</tbody>
</table>
<p>第一列是不同的并行计算方法，其他列分别表示最小值(min)、下四分位数(lq)、平均值(mean)、中位数(median)、上四分位数(uq)、最大值(max)和评估次数(neval)。所有时间单位都是毫秒。</p>
<p>















<figure  id="figure-不同并行包的性能比较基于-ubuntu-平台serial-为串行计算">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="不同并行包的性能比较（基于 ubuntu 平台，Serial 为串行计算）" srcset="
               /media/posts/Rparallel/parallel_performance_comparison_hudf14994197d401580038e8eb0fda4b80_10731_34bffa1cc8e7dbea0e43fbea6c7832db.webp 400w,
               /media/posts/Rparallel/parallel_performance_comparison_hudf14994197d401580038e8eb0fda4b80_10731_bb6daa2395323ee7b5450cdb7efe2411.webp 760w,
               /media/posts/Rparallel/parallel_performance_comparison_hudf14994197d401580038e8eb0fda4b80_10731_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/media/posts/Rparallel/parallel_performance_comparison_hudf14994197d401580038e8eb0fda4b80_10731_34bffa1cc8e7dbea0e43fbea6c7832db.webp"
               width="760"
               height="570"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      不同并行包的性能比较（基于 ubuntu 平台，Serial 为串行计算）
    </figcaption></figure>
</p>
<hr>
<h2 id="9-结论">9 、结论</h2>
<p>选择合适的并行方法取决于多个因素，包括任务的性质、数据规模、可用的硬件资源等。一般来说：</p>
<ol>
<li>对于简单的并行任务，<code>mclapply</code> 在类 Unix 系统上是最直接的选择。</li>
<li>对于需要跨平台兼容性的任务，<code>parLapply</code> 或 <code>foreach</code> 是好选择。</li>
<li>对于更复杂的并行策略，<code>future</code> 包提供了很大的灵活性。</li>
<li>对于与<code>tidyverse</code>生态系统集成，<code>furrr</code> 包是理想的选择。</li>
<li>对于计算密集型任务，考虑使用 <code>RcppParallel</code> 或 GPU 加速。</li>
</ol>
<p>建议在实际应用中进行基准测试，以确定最适合特定问题的并行方法。</p>
<hr>
<font color="red">
对于统计方向的科研，据我个人的浅薄的经验，mclappy是最适合的，尤其是目前的服务器很多都是Linux 系统，在服务器上使用mclappy对一般的统计研究问题的代码运行会有一个很大的提升。</font>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/code/">Code</a>
  
  <a class="badge badge-light" href="/tag/%E5%B9%B6%E8%A1%8C/">并行</a>
  
  <a class="badge badge-light" href="/tag/r/">R</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fikerlz.github.io%2Fpost%2Frparallel%2F&amp;text=R%E5%B9%B6%E8%A1%8C%E6%96%B9%E6%B3%95%E7%AE%80%E8%BF%B0" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fikerlz.github.io%2Fpost%2Frparallel%2F&amp;t=R%E5%B9%B6%E8%A1%8C%E6%96%B9%E6%B3%95%E7%AE%80%E8%BF%B0" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
        
      
      <li>
        <a href="mailto:?subject=R%E5%B9%B6%E8%A1%8C%E6%96%B9%E6%B3%95%E7%AE%80%E8%BF%B0&amp;body=https%3A%2F%2Fikerlz.github.io%2Fpost%2Frparallel%2F" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fikerlz.github.io%2Fpost%2Frparallel%2F&amp;title=R%E5%B9%B6%E8%A1%8C%E6%96%B9%E6%B3%95%E7%AE%80%E8%BF%B0" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="whatsapp://send?text=R%E5%B9%B6%E8%A1%8C%E6%96%B9%E6%B3%95%E7%AE%80%E8%BF%B0%20https%3A%2F%2Fikerlz.github.io%2Fpost%2Frparallel%2F" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Fikerlz.github.io%2Fpost%2Frparallel%2F&amp;title=R%E5%B9%B6%E8%A1%8C%E6%96%B9%E6%B3%95%E7%AE%80%E8%BF%B0" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  
    




  
















  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  












  
  
  
  
  













  
  
  

  
  
    
  
  
    
  

  

  
  <p class="powered-by copyright-license-text">
    © 2024 Me. This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank">CC BY NC ND 4.0</a>
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
        <i class="fab fa-creative-commons-nc fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-nd fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>





  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Hugo Blox Builder</a> — the free, <a href="https://github.com/HugoBlox/hugo-blox-builder" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.938a3a7554cd9f6602290411f64d2617.js"></script>




  

  
  

  













  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  

















<script id="page-data" type="application/json">{"use_headroom":true}</script>


  <script src="/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js" type="module"></script>









  
  


<script src="/en/js/wowchemy.min.62586ca65ca61821fe707eb9fa6268b7.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <pre><code></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>


  <script src="/js/wowchemy-publication.9137013a66774049159934c29c3f0205.js" type="module"></script>


















</body>
</html>
